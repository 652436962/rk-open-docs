# RK2108B PSRAM 做显存带宽评估

文件标识：RK-KF-YF-087

发布版本：V1.0.0

日期：2020.05.20

文件密级：□绝密   □秘密  ■内部资料   □公开

------

**免责声明**

本文档按“现状”提供，福州瑞芯微电子股份有限公司（“本公司”，下同）不对本文档的任何陈述、信息和内容的准确性、可靠性、完整性、适销性、特定目的性和非侵权性提供任何明示或暗示的声明或保证。本文档仅作为使用指导的参考。

由于产品版本升级或其他原因，本文档将可能在未经任何通知的情况下，不定期进行更新或修改。

**商标声明**

“Rockchip”、“瑞芯微”、“瑞芯”均为本公司的注册商标，归本公司所有。

本文档可能提及的其他所有注册商标或商标，由其各自拥有者所有。

**版权所有© 2020福州瑞芯微电子股份有限公司**

超越合理使用范畴，非经本公司书面许可，任何单位和个人不得擅自摘抄、复制本文档内容的部分或全部，并不得以任何形式传播。

福州瑞芯微电子股份有限公司

Fuzhou Rockchip Electronics Co., Ltd.

地址：     福建省福州市铜盘路软件园A区18号

网址：     [www.rock-chips.com](http://www.rock-chips.com)

客户服务电话： +86-4007-700-590

客户服务传真： +86-591-83951833

客户服务邮箱： [fae@rock-chips.com](mailto:fae@rock-chips.com)

------

**前言**

**概述**

**产品版本**

| **日期**   | **版本** | **作者** | **修改说明** |
| ---------- | -------- | -------- | ------------ |
| 2020-03.20 | V1.0     | 黄家钗   | 初始发布     |
|            |          |          |              |

------
[TOC]
---

## 概述

Pisces 项目中 M1 SRAM 大小 1M，系统软件需要占用部分存储空间，导致一些大一点的分辨率或者位宽大的显示效果无法实现，所以需要评估在 M1 上外挂 PSRAM 做显存的方案，主要风险点是 PSRAM 的带宽对显示效果的影响。

由于 M1 无法外接 PSRAM，所以本次测试中使用 RK2108B 外接 PSRAM 硬件平台测试。

## 硬件环境

- 主板： RK2108B EVB 板
- 屏：720x1280 video mode mipi 屏
- PSRAM 颗粒： AP memory APS6404L-xSQ 64 Mb， 工作频率范围：109~133Mhz(non-page boundary crossing)
- RK2108B SCLK_SFC1_SRC 最高支持的频率： 150Mhz
- SCLK_SFC1_SRC 实际工作频率： 132Mhz
- 4 线QPI接口，理论最大带宽为：132 * 4 / 8 = 66 MBps

## CPU 单独访问 PSRAM 带宽

执行测试命令：qpi_psram，CPU 连续向 0x1c000000 地址空间读、写 4M 大小的随机数，测试结果：

| 测试项 | 速度    |
| ------ | ------- |
| 读     | 23 MB/s |
| 写     | 24 MB/s |
| 拷贝   | 12 MB/s |

## VOP 单独访问PSRAM带宽

执行测试命令：display_test color_bar，VOP 根据指定的宽、高、格式、帧率访问 PSRAM 中的数据：

| 图片大小 | 位宽        | 帧率   | VOP 带宽需求 | 显示效果 |
| -------- | ----------- | ------ | ------------ | -------- |
| 720x1280 | 16bit/pixel | 30 fps | 52.73 MBps   | error    |
| 720x1280 | 8bit/pixel  | 45 fps | 39.55 MBps   | ok       |
| 720x1280 | 8bit/pixel  | 30 fps | 26.37 MBps   | ok       |
| 720x1280 | 4bit/pixel  | 45 fps | 19.78 MBps   | ok       |
| 720x1280 | 4bit/pixel  | 30 fps | 13.18 MBps   | ok       |

## VOP 和 CPU 同时访问 PSRAM 带宽

步骤：

1. 执行测试命令：display_test color_bar，VOP 根据指定的宽、高、格式、帧率连续访问 PSRAM 中的数据；
2. 执行测试命令： qpi_psram，qpi_psram 会分别进行读、写、读+写的测试，可以获得 CPU 访问 PSRAM 的带宽能力；

由于屏工作在video模式，VOP 会连续的从 PSRAM 取数据，所以这个 case 构建的是实际应用中带宽最恶略的场景，即此时 VOP 和 CPU 分时交错访问 PSRAM，测试结果如下表格所示：

| 图片大小 | 位宽       | 帧率   | CPU 读 PSRAM 带宽 | CPU 写 PSRAM 带宽 | 显示效果 |
| -------- | ---------- | ------ | ----------------- | ----------------- | -------- |
| 720x1280 | 8bit/pixel | 45 fps | 7 MB/s            | 6 MB/s            | ok       |
| 720x1280 | 8bit/pixel | 30 fps | 12 MB/s           | 11 MB/s           | ok       |
| 720x1280 | 4bit/pixel | 45 fps | 15 MB/s           | 14 MB/s           | ok       |
| 720x1280 | 4bit/pixel | 30 fps | 18 MB/s           | 17 MB/s           | ok       |

## 结论

1. CPU 单独访问 PSRAM 的带宽约为：23~24MBps；
2. VOP(DMA) 在分辨率为720x1280@45fps，位宽为8bit的情况下单独访问 PSRAM 的带宽约为：39.55 MBps；
3. 在 VOP 按 720x1280@30fps 位宽为 4bpp 的模式下，CPU 访问 PSRAM 的带宽能力约为 17~18 MBps，与 CPU 按 720x1280@30fps 位宽为 4bpp 模式下访问 PSRAM 的带宽需求 (13.18 Mbps) 对比，余量较大。